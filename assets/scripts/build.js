"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,a=Array(e.length);n<e.length;n++)a[n]=e[n];return a}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function e(n,a,t){function o(i,u){if(!a[i]){if(!n[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(r)return r(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=a[i]={exports:{}};n[i][0].call(l.exports,function(e){var a=n[i][1][e];return o(a?a:e)},l,l.exports,e,n,a,t)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(e,n,a){(function(n){function a(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n["default"]=e,n}function t(e){return e&&e.__esModule?e:{"default":e}}var o=e("./interface/config"),r=t(o),i=e("./interface/houston"),u=t(i),s=e("./interface/land"),c=t(s),l=e("./interface/launch"),f=t(l),d=e("./engine/dbug"),h=t(d),m=e("./engine/location"),_=t(m),g=e("./engine/route"),p=a(g),v={};v.__modules__=[],v.__config__={},v.__flight__={},v.config=r["default"],v.houston=u["default"],v.land=c["default"],v.launch=f["default"],v.Engine={},v.Engine.dbug=h["default"],v.Engine.location=_["default"],v.Engine.checkDynamic=p.checkDynamic,v.Engine.check=p.check,n.Nasa=v}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./engine/dbug":2,"./engine/location":3,"./engine/route":4,"./interface/config":5,"./interface/houston":6,"./interface/land":7,"./interface/launch":8}],2:[function(e,n,a){Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=function(e){Nasa.__config__.debug&&("boolean"==typeof e?e?(console.log("DEBUG | Nasa: Beginning debug session for this Houston instance..."),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: CONFIG = "+JSON.stringify(Nasa.__config__)),console.log("DEBUG |")):(console.log("DEBUG |"),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: Ending debug session./")):console.log("DEBUG | Nasa: "+e))},n.exports=a["default"]},{}],3:[function(e,n,a){Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=function(){var e=window.location.pathname,n=e.split("/");return n[n.length-1].indexOf(".")===-1&&(e="/"===e.charAt(e.length-1)?e:e+"/"),e},n.exports=a["default"]},{}],4:[function(e,n,a){function t(e){return e&&e.__esModule?e:{"default":e}}function o(e){(0,l["default"])("Executed the route '"+e+"'\n"),Nasa.__flight__.schedule[e]?Nasa.__flight__.schedule[e].forEach(function(e){Nasa.__modules__[e]?Nasa.__modules__[e]():(0,l["default"])("ERR: '"+e+"' is not a registered module!")}):(0,l["default"])("ERR: Can't find '"+e+"' in the flight schedule!")}function r(){if("**"===h[0]){(0,l["default"])("Found dynamic beginning on "+h.join("/"));for(var e=m.length,n=0;n<m.length;n++)if(m[n]===h[1]||"*"===h[1]){n=0===n?1:0,m.splice(0,n),h.splice(0,1);break}if(e===m.length)return!1}return!0}function i(){if("**"===h[h.length-1]){(0,l["default"])("Found dynamic ending on "+h.join("/"));for(var e=m.length,n=m.length-1;n>=0;n--)if(m[n]===h[h.length-2]||"*"===h[h.length-2]){m.splice(n,m.length-n),h.splice(h.length-1,1);break}if(e===m.length)return!1}return!0}function u(e){return(0,d["default"])()===e&&(o(e),!0)}function s(e){if(h=e.split("/"),m=Nasa.Engine.location().split("/"),h.length>m.length)return!1;if(!r()||!i())return!1;for(var n=0;n<h.length;n++)if("*"!==h[n]){var a;if((a=h[n].indexOf("*"))===-1){if(h[n]!==m[n])return!1}else if(0===a){var t=h[n].substr(1,h[n].length);if(m[n].indexOf(t)!==m[n].length-1-(t.length-1))return!1}else if(a===h[n].length-1){var u=h[n].substr(0,a);if(m[n].substr(0,u.length)!==u)return!1}}return o(e),!0}Object.defineProperty(a,"__esModule",{value:!0}),a.check=u,a.checkDynamic=s;var c=e("./dbug"),l=t(c),f=e("./location"),d=t(f),h=[],m=[]},{"./dbug":2,"./location":3}],5:[function(e,n,a){function t(e){var n="";return n="/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e,n="/"===n.charAt(0)?n.substr(1,n.length-1):n,"/"+n}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=function(e){return e.root&&(e.root=t(e.root)),e.cascade&&"boolean"!=typeof e.cascade?console.error("Nasa: config(): Cascade must be a boolean value."):e.debug&&"boolean"!=typeof e.debug?console.error("Nasa: config(): Debug must be a boolean value."):void(Nasa.__config__=e)},n.exports=a["default"]},{}],6:[function(e,n,a){function t(e){return e&&e.__esModule?e:{"default":e}}function o(e){var n=e;return n=0===n.indexOf("/")?n.slice(1,n.length):n,n="/"+n,n=Nasa.__config__.root?Nasa.__config__.root+n:n}Object.defineProperty(a,"__esModule",{value:!0});var r=e("../engine/dbug"),i=t(r),u=e("../engine/route");a["default"]=function(e,n){(0,i["default"])(!0),"undefined"==typeof n&&(n="undefined"==typeof Nasa.__config__.cascade||Nasa.__config__.cascade),Nasa.__flight__.schedule=e,Object.keys(e).every(function(e){var a=o(e);if(e!==a&&(Nasa.__flight__.schedule[a]=Nasa.__flight__.schedule[e],delete Nasa.__flight__.schedule[e]),a.indexOf("*")!==-1){if((0,u.checkDynamic)(a))return n}else if((0,u.check)(a))return n;return!0}),(0,i["default"])(!1)},n.exports=a["default"]},{"../engine/dbug":2,"../engine/route":4}],7:[function(e,n,a){Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=function(e){if("string"==typeof e){if(Nasa.__modules__[e])return Nasa.__modules__[e]();console.error("Nasa.land("+e+"): "+e+" doesn't exist.")}else console.error("Nasa.land("+e+"): Module name must be a string.")},n.exports=a["default"]},{}],8:[function(e,n,a){Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=function(e,n){"string"==typeof e?Nasa.__modules__[e]?console.error("Nasa.launch("+e+"): "+e+" already exists."):Nasa.__modules__[e]=n:console.error("Nasa.launch("+e+"): Module name must be a string.")},n.exports=a["default"]},{}]},{},[1]),Nasa.launch("column-string",function(){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[e.key].concat(_toConsumableArray(e.columns),_toConsumableArray(n)).join(",")}}),Nasa.launch("mapc-region",function(){return[2,10,14,23,25,26,30,34,35,37,40,46,48,50,49,51,57,65,67,71,73,78,82,92,93,99,100,101,107,119,122,131,133,136,139,141,142,144,155,157,158,163,164,165,166,168,170,171,174,175,176,177,178,184,185,187,189,196,198,199,207,208,213,219,220,229,231,243,244,246,248,251,252,258,262,264,266,269,274,277,284,285,286,288,291,298,305,307,308,314,315,317,320,333,335,336,342,344,346,347,350]}),Nasa.launch("nest",function(){return function(e,n,a){var t={};return a||(a=!1),e.forEach(function(e){t[e[n]]=e,a&&delete t[e[n]][n]}),t}}),Nasa.launch("accordion",function(){function e(e){e.innerHTML=e.parentNode.classList.contains("active")?"&minus;":"&plus;"}return function(n,a){var t=a||document.querySelector(n),o=Array.from(t.querySelectorAll('*[data-action="toggle-accordion"]'));o.forEach(function(n){e(n),n.addEventListener("click",function(a){a.preventDefault(),n.parentNode.classList.toggle("active"),e(n)})})}}),Nasa.launch("nav",function(){var e=document.querySelector(".nav-button"),n=document.querySelector(".site-wrapper");e.addEventListener("click",function(e){e.preventDefault(),n.classList.toggle("active")})}),Nasa.launch("tabs",function(){return function(e){var n=document.querySelector(e),a=Array.from(n.querySelectorAll("*[data-tabs] > *")),t=Array.from(n.querySelectorAll("*[data-tab]"));a.forEach(function(e){e.addEventListener("click",function(n){n.preventDefault(),a.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),t.forEach(function(n){n.dataset.tab===e.innerHTML?n.classList.add("active"):n.classList.remove("active")})})}),a[0].click()}}),Nasa.launch("home-page",function(){Nasa.land("tabs")(".disparities")}),Nasa.launch("indicators-page",function(){var e=Nasa.land("tabs"),n=Nasa.land("mass-map"),a=Nasa.land("candlestick"),t={income:Nasa.land("income-mass-map")},o=["as","aa","lat","whi"].map(function(e){return new a(e)}),r=document.querySelector("*[data-municipal]"),i=document.querySelector(".sub-header"),u=new n("map");e(".indicators");var s={"in":function(e){d3.select(this).raise(),i.classList.remove("default"),r.innerText=e.properties.municipal},out:function(){i.classList.add("default")}};t.income.load(function(e){u.setColorRamp(e.census.data,e.census.columns),o.forEach(function(e){e.setRange(u.minimum,u.maximum)}),u.renderData("census",e.census),u.renderData("muni",e.muni,s),"schoolDistricts"in e&&u.renderData("schoolDistricts",e.schoolDistricts)})}),Nasa.launch("outcome-page",function(){var e=Nasa.land("accordion"),n=Array.from(document.querySelectorAll("*[data-accordion]"));n.forEach(function(n){return e(null,n)})});var _createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,a,t){return a&&e(n.prototype,a),t&&e(n,t),n}}();Nasa.launch("candlestick",function(){var e=function(){function e(n){_classCallCheck(this,e),this.canvas=d3.select('*[data-candlestick="'+n+'"]').append("svg")}return _createClass(e,[{key:"setRange",value:function(e,n){this.minimum=e,this.maximum=n}},{key:"renderData",value:function(e){}}]),e}();return e});var _createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,a,t){return a&&e(n.prototype,a),t&&e(n,t),n}}();Nasa.launch("mass-map",function(){function e(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{file:e,data:null,fill:n.fill||null,features:null,strokeWidth:n.strokeWidth||1}}var n=Nasa.land("nest"),a=Nasa.land("mapc-region"),t=function(){function t(n){var a=this;_classCallCheck(this,t),this.identifier=n,this.geoJsonPath="/assets/geojson",this.colors={minimum:"#13314D",maximum:"#57E098",neutral:"#AAAAAA"},this.layers={census:e("ma-census-tracts.json",{strokeWidth:.5}),muni:e("ma-munis.json",{fill:"rgba(0,0,0,0)"}),schoolDistrict:e("ma-school-districts.json")};var o=600,r=570;this.canvas=d3.select(n).append("svg").attr("width",o).attr("height",r),Object.keys(this.layers).forEach(function(e){a.canvas.append("g").attr("data-layer-name",e)});var i=d3.geoAlbers().scale(4e4).rotate([71.057,0]).center([0,42.313]).translate([o/2,r/2]);this.geoPath=d3.geoPath().projection(i)}return _createClass(t,[{key:"loadLayer",value:function(e,n){var a=this.layers[e];a.features?n(a):d3.json(this.geoJsonPath+"/"+a.file,function(e){a.features=e.features,n(a)})}},{key:"setColorRamp",value:function(e,n){var a=e.map(function(e){return n.map(function(n){return e[n]})}),t=a.reduce(function(e,n){return e.concat(n)});this.minimum=Math.min.apply(null,t),this.maximum=Math.max.apply(null,t),this.colorRamp=d3.scaleLinear().domain([this.minimum,this.maximum]).range([this.colors.minimum,this.colors.maximum])}},{key:"renderData",value:function(e,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.loadLayer(e,function(i){var u=n(t.data,t.key),s=i.features.map(function(e){var n=e;return n.properties=u[e.properties[t.index||t.key]],n}),c=d3.select('g[data-layer-name="'+e+'"]').selectAll("path").data(s).enter().append("path").attr("opacity",function(e){return a.indexOf(t.getMuniId(e))!==-1?1:.25}).attr("fill",function(e){return i.fill||o.colorRamp(e.properties[t.column])}).attr("stroke",o.colors.minimum).attr("stroke-width",i.strokeWidth).attr("d",o.geoPath);r&&(r["in"]&&c.on("mouseover",r["in"]).on("mousemove",r["in"]),r.out&&c.on("mouseout",r.out))})}}]),t}();return t}),Nasa.launch("income-mass-map",function(){var e=Nasa.land("column-string"),n=Nasa.land("nest"),a="https://mapc-admin.carto.com/api/v2/sql?q=SELECT ",t={muni:{key:"muni_id",index:"town_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},census:{key:"ct10_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},crosswalk:{data:null}},o={muni:encodeURI(a+e(t.muni,["municipal"])+" FROM b19013_mhi_race_acs_m WHERE acs_year = '2011-15'"),census:encodeURI(a+e(t.census)+" FROM b19013_mhi_race_acs_ct WHERE acs_year = '2011-15'"),crosswalk:encodeURI(a+"ct10_id, muni_id FROM table_datakeys_ct10")},r=function(e){t.muni.data&&t.census.data?e(t):d3.queue().defer(d3.json,o.muni).defer(d3.json,o.census).defer(d3.json,o.crosswalk).await(function(a,o,r,i){t.muni.data=o.rows,t.census.data=r.rows,t.crosswalk.data=n(i.rows,"ct10_id"),t.census.getMuniId=function(e){return t.crosswalk.data[e.properties.ct10_id].muni_id},t.muni.getMuniId=function(e){return e.properties.muni_id},e(t)})};return{load:r,sources:o,datasets:t}}),Nasa.houston({"*":["nav"],"/":["home-page"],"outcome/*/":["outcome-page"],"indicators/":["indicators-page"]});