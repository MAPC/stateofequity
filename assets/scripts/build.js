"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function e(n,t,a){function o(i,s){if(!t[i]){if(!n[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(r)return r(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return o(t?t:e)},l,l.exports,e,n,t,a)}return t[i].exports}for(var r="function"==typeof require&&require,i=0;i<a.length;i++)o(a[i]);return o}({1:[function(e,n,t){(function(n){function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function a(e){return e&&e.__esModule?e:{"default":e}}var o=e("./interface/config"),r=a(o),i=e("./interface/houston"),s=a(i),u=e("./interface/land"),c=a(u),l=e("./interface/launch"),f=a(l),d=e("./engine/dbug"),h=a(d),_=e("./engine/location"),m=a(_),g=e("./engine/route"),p=t(g),v={};v.__modules__=[],v.__config__={},v.__flight__={},v.config=r["default"],v.houston=s["default"],v.land=c["default"],v.launch=f["default"],v.Engine={},v.Engine.dbug=h["default"],v.Engine.location=m["default"],v.Engine.checkDynamic=p.checkDynamic,v.Engine.check=p.check,n.Nasa=v}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./engine/dbug":2,"./engine/location":3,"./engine/route":4,"./interface/config":5,"./interface/houston":6,"./interface/land":7,"./interface/launch":8}],2:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){Nasa.__config__.debug&&("boolean"==typeof e?e?(console.log("DEBUG | Nasa: Beginning debug session for this Houston instance..."),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: CONFIG = "+JSON.stringify(Nasa.__config__)),console.log("DEBUG |")):(console.log("DEBUG |"),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: Ending debug session./")):console.log("DEBUG | Nasa: "+e))},n.exports=t["default"]},{}],3:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=window.location.pathname,n=e.split("/");return n[n.length-1].indexOf(".")===-1&&(e="/"===e.charAt(e.length-1)?e:e+"/"),e},n.exports=t["default"]},{}],4:[function(e,n,t){function a(e){return e&&e.__esModule?e:{"default":e}}function o(e){(0,l["default"])("Executed the route '"+e+"'\n"),Nasa.__flight__.schedule[e]?Nasa.__flight__.schedule[e].forEach(function(e){Nasa.__modules__[e]?Nasa.__modules__[e]():(0,l["default"])("ERR: '"+e+"' is not a registered module!")}):(0,l["default"])("ERR: Can't find '"+e+"' in the flight schedule!")}function r(){if("**"===h[0]){(0,l["default"])("Found dynamic beginning on "+h.join("/"));for(var e=_.length,n=0;n<_.length;n++)if(_[n]===h[1]||"*"===h[1]){n=0===n?1:0,_.splice(0,n),h.splice(0,1);break}if(e===_.length)return!1}return!0}function i(){if("**"===h[h.length-1]){(0,l["default"])("Found dynamic ending on "+h.join("/"));for(var e=_.length,n=_.length-1;n>=0;n--)if(_[n]===h[h.length-2]||"*"===h[h.length-2]){_.splice(n,_.length-n),h.splice(h.length-1,1);break}if(e===_.length)return!1}return!0}function s(e){return(0,d["default"])()===e&&(o(e),!0)}function u(e){if(h=e.split("/"),_=Nasa.Engine.location().split("/"),h.length>_.length)return!1;if(!r()||!i())return!1;for(var n=0;n<h.length;n++)if("*"!==h[n]){var t;if((t=h[n].indexOf("*"))===-1){if(h[n]!==_[n])return!1}else if(0===t){var a=h[n].substr(1,h[n].length);if(_[n].indexOf(a)!==_[n].length-1-(a.length-1))return!1}else if(t===h[n].length-1){var s=h[n].substr(0,t);if(_[n].substr(0,s.length)!==s)return!1}}return o(e),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.check=s,t.checkDynamic=u;var c=e("./dbug"),l=a(c),f=e("./location"),d=a(f),h=[],_=[]},{"./dbug":2,"./location":3}],5:[function(e,n,t){function a(e){var n="";return n="/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e,n="/"===n.charAt(0)?n.substr(1,n.length-1):n,"/"+n}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return e.root&&(e.root=a(e.root)),e.cascade&&"boolean"!=typeof e.cascade?console.error("Nasa: config(): Cascade must be a boolean value."):e.debug&&"boolean"!=typeof e.debug?console.error("Nasa: config(): Debug must be a boolean value."):void(Nasa.__config__=e)},n.exports=t["default"]},{}],6:[function(e,n,t){function a(e){return e&&e.__esModule?e:{"default":e}}function o(e){var n=e;return n=0===n.indexOf("/")?n.slice(1,n.length):n,n="/"+n,n=Nasa.__config__.root?Nasa.__config__.root+n:n}Object.defineProperty(t,"__esModule",{value:!0});var r=e("../engine/dbug"),i=a(r),s=e("../engine/route");t["default"]=function(e,n){(0,i["default"])(!0),"undefined"==typeof n&&(n="undefined"==typeof Nasa.__config__.cascade||Nasa.__config__.cascade),Nasa.__flight__.schedule=e,Object.keys(e).every(function(e){var t=o(e);if(e!==t&&(Nasa.__flight__.schedule[t]=Nasa.__flight__.schedule[e],delete Nasa.__flight__.schedule[e]),t.indexOf("*")!==-1){if((0,s.checkDynamic)(t))return n}else if((0,s.check)(t))return n;return!0}),(0,i["default"])(!1)},n.exports=t["default"]},{"../engine/dbug":2,"../engine/route":4}],7:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){if("string"==typeof e){if(Nasa.__modules__[e])return Nasa.__modules__[e]();console.error("Nasa.land("+e+"): "+e+" doesn't exist.")}else console.error("Nasa.land("+e+"): Module name must be a string.")},n.exports=t["default"]},{}],8:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,n){"string"==typeof e?Nasa.__modules__[e]?console.error("Nasa.launch("+e+"): "+e+" already exists."):Nasa.__modules__[e]=n:console.error("Nasa.launch("+e+"): Module name must be a string.")},n.exports=t["default"]},{}]},{},[1]),Nasa.launch("column-string",function(){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[e.key].concat(_toConsumableArray(e.columns),_toConsumableArray(n)).join(",")}}),Nasa.launch("mapc-region",function(){return[2,10,14,23,25,26,30,34,35,37,40,46,48,50,49,51,57,65,67,71,73,78,82,92,93,99,100,101,107,119,122,131,133,136,139,141,142,144,155,157,158,163,164,165,166,168,170,171,174,175,176,177,178,184,185,187,189,196,198,199,207,208,213,219,220,229,231,243,244,246,248,251,252,258,262,264,266,269,274,277,284,285,286,288,291,298,305,307,308,314,315,317,320,333,335,336,342,344,346,347,350]}),Nasa.launch("nest",function(){return function(e,n,t){var a={};return t||(t=!1),e.forEach(function(e){a[e[n]]=e,t&&delete a[e[n]][n]}),a}}),Nasa.launch("accordion",function(){function e(e){e.innerHTML=e.parentNode.classList.contains("active")?"&minus;":"&plus;"}return function(n,t){var a=t||document.querySelector(n),o=Array.from(a.querySelectorAll('*[data-action="toggle-accordion"]'));o.forEach(function(n){e(n),n.addEventListener("click",function(t){t.preventDefault(),n.parentNode.classList.toggle("active"),e(n)})})}}),Nasa.launch("nav",function(){var e=document.querySelector(".nav-button"),n=document.querySelector(".site-wrapper");e.addEventListener("click",function(e){e.preventDefault(),n.classList.toggle("active")})}),Nasa.launch("tabs",function(){return function(e){var n=document.querySelector(e),t=Array.from(n.querySelectorAll("*[data-tabs] > *")),a=Array.from(n.querySelectorAll("*[data-tab]"));t.forEach(function(e){e.addEventListener("click",function(n){n.preventDefault(),t.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),a.forEach(function(n){n.dataset.tab===e.innerHTML?n.classList.add("active"):n.classList.remove("active")})})}),t[0].click()}}),Nasa.launch("home-page",function(){Nasa.land("tabs")(".disparities")}),Nasa.launch("indicators-page",function(){var e=Nasa.land("mass-map"),n=Nasa.land("tabs"),t={income:Nasa.land("income-mass-map")},a=document.querySelector("*[data-municipal]"),o=document.querySelector(".sub-header"),r=new e("map");n(".indicators"),t.income.load(function(e){r.setColorRamp(e.census.data,e.census.columns),r.renderData("census",e.census),r.renderData("muni",e.muni,{"in":function(e){d3.select(this).raise(),o.classList.remove("default"),a.innerText=e.properties.municipal},out:function(e){o.classList.add("default")}}),"schoolDistricts"in e&&r.renderData("schoolDistricts",e.schoolDistricts)})}),Nasa.launch("outcome-page",function(){var e=Nasa.land("accordion"),n=Array.from(document.querySelectorAll("*[data-accordion]"));n.forEach(function(n){return e(null,n)})});var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();Nasa.launch("mass-map",function(){function e(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{file:e,data:null,fill:n.fill||null,features:null,strokeWidth:n.strokeWidth||1}}var n=Nasa.land("nest"),t=Nasa.land("mapc-region"),a=function(){function a(n){var t=this;_classCallCheck(this,a),this.identifier=n,this.geoJsonPath="/assets/geojson",this.colors={minimum:"#13314D",maximum:"#57E098",neutral:"#AAAAAA"},this.layers={census:e("ma-census-tracts.json",{strokeWidth:.5}),muni:e("ma-munis.json",{fill:"rgba(0,0,0,0)"}),schoolDistrict:e("ma-school-districts.json")};var o=600,r=570;this.canvas=d3.select(n).append("svg").attr("width",o).attr("height",r),Object.keys(this.layers).forEach(function(e){t.canvas.append("g").attr("data-layer-name",e)});var i=d3.geoAlbers().scale(4e4).rotate([71.057,0]).center([0,42.313]).translate([o/2,r/2]);this.geoPath=d3.geoPath().projection(i)}return _createClass(a,[{key:"loadLayer",value:function(e,n){var t=this.layers[e];t.features?n(t):d3.json(this.geoJsonPath+"/"+t.file,function(e){t.features=e.features,n(t)})}},{key:"setColorRamp",value:function(e,n){var t=e.map(function(e){return n.map(function(n){return e[n]})}),a=t.reduce(function(e,n){return e.concat(n)}),o=Math.min.apply(null,a),r=Math.max.apply(null,a),i=d3.scaleLinear().domain([o,r]).range([this.colors.minimum,this.colors.maximum]);this.colorRamp=i}},{key:"renderData",value:function(e,a){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.loadLayer(e,function(i){var s=n(a.data,a.key),u=i.features.map(function(e){var n=e;return n.properties=s[e.properties[a.index||a.key]],n}),c=d3.select('g[data-layer-name="'+e+'"]').selectAll("path").data(u).enter().append("path").attr("opacity",function(e){return t.indexOf(a.getMuniId(e))!==-1?1:.25}).attr("fill",function(e){return i.fill||o.colorRamp(e.properties[a.column])}).attr("stroke",o.colors.minimum).attr("stroke-width",i.strokeWidth).attr("d",o.geoPath);r&&(r["in"]&&c.on("mouseover",r["in"]).on("mousemove",r["in"]),r.out&&c.on("mouseout",r.out))})}}]),a}();return a}),Nasa.launch("income-mass-map",function(){var e=Nasa.land("column-string"),n=Nasa.land("nest"),t="https://mapc-admin.carto.com/api/v2/sql?q=SELECT ",a={muni:{key:"muni_id",index:"town_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},census:{key:"ct10_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},crosswalk:{data:null}},o={muni:encodeURI(t+e(a.muni,["municipal"])+" FROM b19013_mhi_race_acs_m WHERE acs_year = '2011-15'"),census:encodeURI(t+e(a.census)+" FROM b19013_mhi_race_acs_ct WHERE acs_year = '2011-15'"),crosswalk:encodeURI(t+"ct10_id, muni_id FROM table_datakeys_ct10")},r=function(e){a.muni.data&&a.census.data?e(a):d3.queue().defer(d3.json,o.muni).defer(d3.json,o.census).defer(d3.json,o.crosswalk).await(function(t,o,r,i){a.muni.data=o.rows,a.census.data=r.rows,a.crosswalk.data=n(i.rows,"ct10_id"),a.census.getMuniId=function(e){return a.crosswalk.data[e.properties.ct10_id].muni_id},a.muni.getMuniId=function(e){return e.properties.muni_id},e(a)})};return{load:r,sources:o,datasets:a}}),Nasa.houston({"*":["nav"],"/":["home-page"],"outcome/*/":["outcome-page"],"indicators/":["indicators-page"]});