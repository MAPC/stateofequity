"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}!function e(n,t,a){function i(o,s){if(!t[o]){if(!n[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[o]={exports:{}};n[o][0].call(l.exports,function(e){var t=n[o][1][e];return i(t?t:e)},l,l.exports,e,n,t,a)}return t[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,n,t){(function(n){function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n["default"]=e,n}function a(e){return e&&e.__esModule?e:{"default":e}}var i=e("./interface/config"),r=a(i),o=e("./interface/houston"),s=a(o),c=e("./interface/land"),u=a(c),l=e("./interface/launch"),d=a(l),f=e("./engine/dbug"),m=a(f),h=e("./engine/location"),g=a(h),_=e("./engine/route"),p=t(_),v={};v.__modules__=[],v.__config__={},v.__flight__={},v.config=r["default"],v.houston=s["default"],v.land=u["default"],v.launch=d["default"],v.Engine={},v.Engine.dbug=m["default"],v.Engine.location=g["default"],v.Engine.checkDynamic=p.checkDynamic,v.Engine.check=p.check,n.Nasa=v}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./engine/dbug":2,"./engine/location":3,"./engine/route":4,"./interface/config":5,"./interface/houston":6,"./interface/land":7,"./interface/launch":8}],2:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){Nasa.__config__.debug&&("boolean"==typeof e?e?(console.log("DEBUG | Nasa: Beginning debug session for this Houston instance..."),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: CONFIG = "+JSON.stringify(Nasa.__config__)),console.log("DEBUG |")):(console.log("DEBUG |"),console.log("DEBUG | Nasa: -------------------------------------------------------"),console.log("DEBUG | Nasa: Ending debug session./")):console.log("DEBUG | Nasa: "+e))},n.exports=t["default"]},{}],3:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=window.location.pathname,n=e.split("/");return n[n.length-1].indexOf(".")===-1&&(e="/"===e.charAt(e.length-1)?e:e+"/"),e},n.exports=t["default"]},{}],4:[function(e,n,t){function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){(0,l["default"])("Executed the route '"+e+"'\n"),Nasa.__flight__.schedule[e]?Nasa.__flight__.schedule[e].forEach(function(e){Nasa.__modules__[e]?Nasa.__modules__[e]():(0,l["default"])("ERR: '"+e+"' is not a registered module!")}):(0,l["default"])("ERR: Can't find '"+e+"' in the flight schedule!")}function r(){if("**"===m[0]){(0,l["default"])("Found dynamic beginning on "+m.join("/"));for(var e=h.length,n=0;n<h.length;n++)if(h[n]===m[1]||"*"===m[1]){n=0===n?1:0,h.splice(0,n),m.splice(0,1);break}if(e===h.length)return!1}return!0}function o(){if("**"===m[m.length-1]){(0,l["default"])("Found dynamic ending on "+m.join("/"));for(var e=h.length,n=h.length-1;n>=0;n--)if(h[n]===m[m.length-2]||"*"===m[m.length-2]){h.splice(n,h.length-n),m.splice(m.length-1,1);break}if(e===h.length)return!1}return!0}function s(e){return(0,f["default"])()===e&&(i(e),!0)}function c(e){if(m=e.split("/"),h=Nasa.Engine.location().split("/"),m.length>h.length)return!1;if(!r()||!o())return!1;for(var n=0;n<m.length;n++)if("*"!==m[n]){var t;if((t=m[n].indexOf("*"))===-1){if(m[n]!==h[n])return!1}else if(0===t){var a=m[n].substr(1,m[n].length);if(h[n].indexOf(a)!==h[n].length-1-(a.length-1))return!1}else if(t===m[n].length-1){var s=m[n].substr(0,t);if(h[n].substr(0,s.length)!==s)return!1}}return i(e),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.check=s,t.checkDynamic=c;var u=e("./dbug"),l=a(u),d=e("./location"),f=a(d),m=[],h=[]},{"./dbug":2,"./location":3}],5:[function(e,n,t){function a(e){var n="";return n="/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e,n="/"===n.charAt(0)?n.substr(1,n.length-1):n,"/"+n}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return e.root&&(e.root=a(e.root)),e.cascade&&"boolean"!=typeof e.cascade?console.error("Nasa: config(): Cascade must be a boolean value."):e.debug&&"boolean"!=typeof e.debug?console.error("Nasa: config(): Debug must be a boolean value."):void(Nasa.__config__=e)},n.exports=t["default"]},{}],6:[function(e,n,t){function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){var n=e;return n=0===n.indexOf("/")?n.slice(1,n.length):n,n="/"+n,n=Nasa.__config__.root?Nasa.__config__.root+n:n}Object.defineProperty(t,"__esModule",{value:!0});var r=e("../engine/dbug"),o=a(r),s=e("../engine/route");t["default"]=function(e,n){(0,o["default"])(!0),"undefined"==typeof n&&(n="undefined"==typeof Nasa.__config__.cascade||Nasa.__config__.cascade),Nasa.__flight__.schedule=e,Object.keys(e).every(function(e){var t=i(e);if(e!==t&&(Nasa.__flight__.schedule[t]=Nasa.__flight__.schedule[e],delete Nasa.__flight__.schedule[e]),t.indexOf("*")!==-1){if((0,s.checkDynamic)(t))return n}else if((0,s.check)(t))return n;return!0}),(0,o["default"])(!1)},n.exports=t["default"]},{"../engine/dbug":2,"../engine/route":4}],7:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){if("string"==typeof e){if(Nasa.__modules__[e])return Nasa.__modules__[e]();console.error("Nasa.land("+e+"): "+e+" doesn't exist.")}else console.error("Nasa.land("+e+"): Module name must be a string.")},n.exports=t["default"]},{}],8:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,n){"string"==typeof e?Nasa.__modules__[e]?console.error("Nasa.launch("+e+"): "+e+" already exists."):Nasa.__modules__[e]=n:console.error("Nasa.launch("+e+"): Module name must be a string.")},n.exports=t["default"]},{}]},{},[1]),Nasa.launch("column-string",function(){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[e.key].concat(_toConsumableArray(e.columns),_toConsumableArray(n)).join(",")}}),Nasa.launch("mapc-region",function(){return[2,10,14,23,25,26,30,34,35,37,40,46,48,50,49,51,57,65,67,71,73,78,82,92,93,99,100,101,107,119,122,131,133,136,139,141,142,144,155,157,158,163,164,165,166,168,170,171,174,175,176,177,178,184,185,187,189,196,198,199,207,208,213,219,220,229,231,243,244,246,248,251,252,258,262,264,266,269,274,277,284,285,286,288,291,298,305,307,308,314,315,317,320,333,335,336,342,344,346,347,350]}),Nasa.launch("matrix-bounds",function(){return function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.map(function(e){return n.map(function(n){return parseInt(e[n])})}),i=t?function(e){return e>0}:function(e){return e>=0},r=a.reduce(function(e,n){return e.concat(n)}).filter(function(e){return null!==e&&i(e)}),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return{min:o,max:s}}}),Nasa.launch("nest",function(){return function(e,n,t){var a={};return t||(t=!1),e.forEach(function(e){a[e[n]]=e,t&&delete a[e[n]][n]}),a}}),Nasa.launch("normalize",function(){return function(e){return e.toLowerCase().split(" ").join("-")}}),Nasa.launch("string-format",function(){function e(e){return e.toLocaleString("en-US")}function n(n){return"$"+e(n)}function t(n){return e(n)+"%"}return{money:n,number:e,percent:t}}),Nasa.launch("accordion",function(){function e(e){e.innerHTML=e.parentNode.classList.contains("active")?"&minus;":"&plus;"}return function(n,t){var a=t||document.querySelector(n),i=Array.from(a.querySelectorAll('*[data-action="toggle-accordion"]'));i.forEach(function(n){e(n),n.parentNode.addEventListener("click",function(t){t.preventDefault(),n.parentNode.classList.toggle("active"),e(n)})})}}),Nasa.launch("nav",function(){var e=document.querySelector(".nav-button"),n=document.querySelector(".site-wrapper");e.addEventListener("click",function(e){e.preventDefault(),n.classList.toggle("active")})}),Nasa.launch("tabs",function(){return function(e){var n=document.querySelector(e),t=Array.from(n.querySelectorAll("*[data-tabs] > *")),a=Array.from(n.querySelectorAll("*[data-tab]"));t.forEach(function(e){e.addEventListener("click",function(n){n.preventDefault(),t.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),a.forEach(function(n){n.dataset.tab===e.innerHTML?n.classList.add("active"):n.classList.remove("active")})})}),t[0].click()}}),Nasa.launch("home-page",function(){Nasa.land("tabs")(".disparities")}),Nasa.launch("indicators-page",function(){var e=Nasa.land("tabs"),n=Nasa.land("mass-map"),t=Nasa.land("candlestick"),a={income:Nasa.land("income-mass-map")},i={homeownership:Nasa.land("homeownership-chart")},r=["as","aa","lat","whi"].map(function(e){return new t(e)}),o=document.querySelector("*[data-municipal]"),s=document.querySelector(".sub-header"),c=new n("map");e(".indicators");var u={"in":function(e){d3v4.select(this).raise(),s.classList.remove("default"),o.innerText=e.properties.municipal,r.forEach(function(n){n.addTick(e.properties,e.properties.municipal,e.properties.municipal)})},out:function(e){s.classList.add("default"),r.forEach(function(n){n.removeTick(e.properties.municipal)})}};i.homeownership("*[data-chart-viewer]"),a.income.load(function(e){c.setFormat("money"),c.setColorRamp(e.census.data,e.census.columns),c.renderData("census",e.census),c.renderData("muni",e.muni,u),"schoolDistricts"in e&&c.renderData("schoolDistricts",e.schoolDistricts),r.forEach(function(n){n.setColumnSuffix(e.suffix),n.setRange(c.minimum,c.maximum),n.setFormat("money"),n.renderData({bounded:e.muni,median:e.region})})})}),Nasa.launch("outcome-page",function(){var e=Nasa.land("accordion"),n=Array.from(document.querySelectorAll("*[data-accordion]"));n.forEach(function(n){return e(null,n)})});var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();Nasa.launch("candlestick",function(){var e=Nasa.land("matrix-bounds"),n=Nasa.land("mapc-region"),t=Nasa.land("normalize"),a=Nasa.land("string-format"),i=function(){function i(e){_classCallCheck(this,i),this.canvas=d3v4.select('*[data-candlestick="'+e+'"]').append("div").attr("class","content"),this.stick=this.canvas.append("div").attr("class","stick"),this.bounding={min:this.stick.append("span").attr("class","bound min-bound"),max:this.stick.append("span").attr("class","bound max-bound")},this.identifier=e,this.column=e,this.format=a.number}return _createClass(i,[{key:"setFormat",value:function(e){this.format=a[e]}},{key:"setColumnSuffix",value:function(e){this.suffix=e,this.column=this.identifier+e}},{key:"setRange",value:function(e,n){this.range={min:e,max:n}}},{key:"leftOffset",value:function(e){return 100*Math.abs(e/(this.range.min-this.range.max))}},{key:"addTick",value:function(e,n,a){var i=e[this.column];if(i>0){var r=this.leftOffset(i),o=this.canvas.append("div").attr("class","tick").style("left",r+"%");a&&o.attr("id",t(a)).attr("class","tick identified");var s=o.append("div").attr("class","tick-info");s.append("p").attr("class","tick-title").html(n),s.append("p").attr("class","tick-value").html(this.format(i))}}},{key:"removeTick",value:function(e){d3v4.selectAll("#"+t(e)).remove()}},{key:"renderData",value:function(t){var a=t.bounded.data.filter(function(e){return n.indexOf(e.muni_id)!==-1}),i=e(a,[this.column],!0),r=100*Math.abs((i.min-i.max)/(this.range.min-this.range.max)),o=this.leftOffset(i.min);this.stick.style("width",r+"%").style("left",o+"%"),this.bounding.min.html(this.format(i.min)),this.bounding.max.html(this.format(i.max)),this.addTick(t.median.data,"Regional Median")}}]),i}();return i});var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();Nasa.launch("mass-map",function(){function e(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{file:e,data:null,fill:n.fill||null,features:null,strokeWidth:n.strokeWidth||1}}var n=Nasa.land("nest"),t=Nasa.land("string-format"),a=Nasa.land("mapc-region"),i=Nasa.land("matrix-bounds"),r=function(){function r(n){var a=this;_classCallCheck(this,r),this.identifier=n,this.geoJsonPath="/assets/geojson",this.colors={minimum:"#13314D",maximum:"#57E098",neutral:"#AAAAAA"},this.layers={census:e("ma-census-tracts.json",{strokeWidth:.5}),muni:e("ma-munis.json",{fill:"rgba(0,0,0,0)"}),schoolDistrict:e("ma-school-districts.json")};var i=600,o=570;this.canvas=d3v4.select(n).append("svg").attr("width",i).attr("height",o),Object.keys(this.layers).forEach(function(e){a.canvas.append("g").attr("data-layer-name",e)});var s=d3v4.geoAlbers().scale(4e4).rotate([71.09,0]).center([0,42.34]).translate([i/2,o/2]);this.geoPath=d3v4.geoPath().projection(s),this.format=t.number}return _createClass(r,[{key:"loadLayer",value:function(e,n){var t=this.layers[e];t.features?n(t):d3v4.json(this.geoJsonPath+"/"+t.file,function(e){t.features=e.features,n(t)})}},{key:"setFormat",value:function(e){this.format=t[e]}},{key:"setColorRamp",value:function(e,n){var t=i(e,n),a=t.min,r=t.max;this.minimum=a,this.maximum=r,d3v4.select(".range-min").html(this.format(a)),d3v4.select(".range-max").html(this.format(r)),this.colorRamp=d3v4.scaleLinear().domain([this.minimum,this.maximum]).range([this.colors.minimum,this.colors.maximum])}},{key:"renderData",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.loadLayer(e,function(o){var s=n(t.data,t.key),c=o.features.map(function(e){var n=e;return n.properties=s[e.properties[t.index||t.key]],n}),u=d3v4.select('g[data-layer-name="'+e+'"]').selectAll("path").data(c).enter().append("path").attr("opacity",function(e){return a.indexOf(t.getMuniId(e))!==-1?1:.25}).attr("fill",function(e){return o.fill||i.colorRamp(e.properties[t.column])}).attr("stroke",i.colors.minimum).attr("stroke-width",o.strokeWidth).attr("d",i.geoPath);r&&(r["in"]&&u.on("mouseover",r["in"]).on("mousemove",r["in"]),r.out&&u.on("mouseout",r.out))})}}]),r}();return r}),Nasa.launch("income-mass-map",function(){var e=Nasa.land("column-string"),n=Nasa.land("nest"),t="https://mapc-admin.carto.com/api/v2/sql?q=SELECT ",a="2011-15",i={suffix:"_mhi",muni:{key:"muni_id",index:"town_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},census:{key:"ct10_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],column:"whi_mhi",data:null},crosswalk:{data:null},region:{key:"msa_id",columns:["whi_mhi","aa_mhi","as_mhi","lat_mhi"],data:null}},r={muni:encodeURI(t+e(i.muni,["municipal"])+(" FROM b19013_mhi_race_acs_m WHERE acs_year = '"+a+"'")),census:encodeURI(t+e(i.census)+(" FROM b19013_mhi_race_acs_ct WHERE acs_year = '"+a+"'")),region:encodeURI(t+e(i.region)+(" FROM b19013_mhi_race_acs_msa WHERE acs_year = '"+a+"' AND msa_id = '14460'")),crosswalk:encodeURI(t+"ct10_id, muni_id FROM table_datakeys_ct10")},o=function(e){i.muni.data&&i.census.data?e(i):d3v4.queue().defer(d3v4.json,r.muni).defer(d3v4.json,r.census).defer(d3v4.json,r.region).defer(d3v4.json,r.crosswalk).await(function(t,a,r,o,s){i.muni.data=a.rows,i.census.data=r.rows,i.region.data=o.rows[0],i.crosswalk.data=n(s.rows,"ct10_id"),i.census.getMuniId=function(e){return i.crosswalk.data[e.properties.ct10_id].muni_id},i.muni.getMuniId=function(e){return e.properties.muni_id},e(i)})};return{load:o,sources:r,datasets:i}}),Nasa.launch("homeownership-chart",function(){var e=Nasa.land("string-format");return function(n){var t=document.querySelector(n),a="https://mapc-admin.carto.com/api/v2/sql?q=SELECT%20*%20FROM%20storage.soe_hous_hmda_race_mapc";d3.json(a,function(n){var a=[{series:"White",2009:n.rows[0].hmda09,2015:n.rows[0].hmda15},{series:"Black",2009:n.rows[1].hmda09,2015:n.rows[1].hmda15},{series:"Latino",2009:n.rows[2].hmda09,2015:n.rows[2].hmda15},{series:"Asian",2009:n.rows[3].hmda09,2015:n.rows[3].hmda15},{series:"Native American",2009:n.rows[4].hmda09,2015:n.rows[4].hmda15}];d3.nest().key(function(e){return e.schoolyear}).entries(n.rows),c3.generate({bindto:t,data:{json:a,keys:{value:["2009","2015"]},type:"bar"},bar:{width:{ratio:.9}},axis:{x:{type:"category",categories:["White","Black","Latino","Asian","Native American"],height:40,tick:{fit:!0,multiline:!0,rotate:0}},y:{tick:{format:e.percent},padding:{top:100,bottom:100},label:{text:"Mortgage loan application denial rate, high-income",position:"outer-middle"}}},size:{height:350},color:{pattern:["#1c164e","#6dbd45"]}})})}}),Nasa.houston({"*":["nav"],"/":["home-page"],"goals/*/":["outcome-page"],"indicators/":["indicators-page"]});